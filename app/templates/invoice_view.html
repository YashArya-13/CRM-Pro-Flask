{% extends "base.html" %}
{% block content %}
<div class="card p-3">
  <div class="d-flex justify-content-between">
    <h4>Invoice #{{ inv.id }}</h4>
    <div><small>{{ inv.created_at.strftime('%Y-%m-%d %H:%M') }}</small></div>
  </div>

  <div class="mt-3">
    <p><b>Client:</b> {{ inv.client_name }}</p>
    <table class="table table-sm">
      <thead><tr><th>Item</th><th>Qty</th><th>Price</th><th>Total</th></tr></thead>
      <tbody>
        {% set subtotal = 0 %}
        {% for it in items %}
        {% set line = (it.qty * it.price) %}
        <tr>
          <td>{{ it.name }}</td>
          <td>{{ it.qty }}</td>
          <td>{{ "%.2f"|format(it.price) }}</td>
          <td>{{ "%.2f"|format(line) }}</td>
        </tr>
        {% set subtotal = subtotal + line %}
        {% endfor %}
      </tbody>
    </table>
    <div class="text-end">
      <p>Subtotal: <b>₹{{ "%.2f"|format(subtotal) }}</b></p>
      <p>Tax ({{ inv.tax_percent }}%): <b>₹{{ "%.2f"|format(subtotal * inv.tax_percent / 100.0) }}</b></p>
      <h4>Total: <b>₹{{ "%.2f"|format(inv.total()) }}</b></h4>
    </div>
  </div>
  <div class="mt-3">
    <a class="btn btn-primary" href="{{ url_for('invoice_pdf', id=inv.id) }}">Download PDF</a>
    <a class="btn btn-outline-secondary" href="{{ url_for('invoices') }}">Back</a>
  </div>
</div>
{% endblock %}
